# Release Workflow & CI/CD Guide

This document outlines the release process for **FreelanceFlow**, covering automated versioning, build pipelines, and the software update system.

## üöÄ Quick Release Guide

To publish a new version of the application, simply run the helper tool from your terminal:

```bash
# 1. Bump Patch Version (e.g., 1.0.0 -> 1.0.1)
go run cmd/release/main.go -part patch

# 2. Bump Minor Version (e.g., 1.0.0 -> 1.1.0)
go run cmd/release/main.go -part minor

# 3. Bump Major Version (e.g., 1.0.0 -> 2.0.0)
go run cmd/release/main.go -part major
```

**What this tool does:**

1.  Updates the version in `wails.json`.
2.  Creates a new git commit (`Bump version to vX.Y.Z`).
3.  Creates a new git tag (`vX.Y.Z`).
4.  Instructions you to push the code and tag.

After the tool finishes, push the changes:

```bash
git push origin main <tag_name>
```

---

## ‚öôÔ∏è CI/CD Pipeline (GitHub Actions)

When you push a tag starting with `v*` (e.g., `v1.0.1`), the GitHub Actions workflow in `.github/workflows/release.yml` is triggered.

### Workflow Steps:

1.  **Build macOS Apps**:
    - Builds for both `darwin/amd64` (Intel) and `darwin/arm64` (Apple Silicon).
    - Injects the version number into the binary using `-ldflags`.
2.  **Ad-hoc Signing**:
    - Signs the application using `codesign --sign -` to allow it to run locally and update (bypassing strict Gatekeeper blocks for development team distribution).
3.  **Packaging (.dmg)**:
    - Uses `create-dmg` to package the `.app` into a user-friendly `.dmg` installer.
4.  **Manifest Generation (`update.json`)**:
    - Calculates SHA256 checksums of the generated `.dmg` files.
    - Generates update metadata including release notes and download URLs.
5.  **GitHub Release**:
    - Creates a new Release entry on GitHub.
    - Uploads the `.dmg` files and `update.json` as assets.

---

## üõ†Ô∏è Update System Internals

The application's auto-update system works by checking the `update.json` file attached to the "Latest Release" on GitHub.

### `update.json` Format

This file is automatically generated by the CI pipeline (`cmd/gen-update-info/main.go`) and looks like this:

```json
{
  "version": "1.0.1",
  "releaseDate": "2023-10-27T10:00:00Z",
  "releaseNotes": "...",
  "platforms": {
    "darwin-amd64": {
      "url": "https://github.com/user/repo/releases/download/v1.0.1/FreelanceFlow-1.0.1-darwin-amd64.dmg",
      "signature": "sha256:...",
      "size": 12345678
    },
    "darwin-arm64": {
      "url": "...",
      "signature": "sha256:...",
      "size": 12345678
    }
  }
}
```

### Components

- **Backend**: `internal/update` (parsing logic) & `internal/services/update_service.go` (business logic).
- **Frontend**: `UpdateDialog.vue` (UI) & `stores/update.ts` (State).
- **Tools**: `cmd/gen-update-info` (CI Tool) & `cmd/release` (Dev Tool).

---

## üß™ Testing Updates Locally

1.  **Build Release Tool**: `go build -o release-tool cmd/release/main.go`
2.  **Simulate Update**:
    - You can run the backend tests: `go test ./internal/services/...`
    - Or use the `UpdateDialog` in the app to "Open Release Page" (since actual download logic in Phase 1 opens the browser).
